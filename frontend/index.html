<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElderSafe Camera Stream</title>
        <script src="config.js"></script>
        <link rel="stylesheet" href="styles.css">
</head>
<body>
        <header class="site-header">
            <div class="inner">
                <div class="logo">ElderSafe</div>
                <nav class="nav">
                    <a href="/" class="active">Live</a>
                    <a href="/dashboard.html">Dashboard</a>
                </nav>
            </div>
        </header>

        <main class="container">
            <section class="hero">
                <div>
                    <h1>ElderSafe Live Camera Stream</h1>
                    <p class="muted small">Real-time feed and environment status for quick monitoring.</p>
                </div>
                <!-- <div class="cta">
                    <a class="btn btn-secondary" href="/dashboard.html">Historical Dashboard</a>
                </div> -->
            </section>

            <div class="grid">
                <div class="col-8">
                    <div class="card">
                        <h3 class="small muted">Live Feed</h3>
                        <img src="" alt="Live Camera Feed" style="width:100%; border-radius:8px; margin-top:8px">
                    </div>
                </div>
                <div class="col-4">
                    <div class="card status">
                        <div>
                            <h3 class="small muted">Environment</h3>
                            <p>Temperature: <strong id="temp">Loading...</strong></p>
                            <p>Humidity: <strong id="hum">Loading...</strong></p>
                            <p>Smoke: <strong id="smoke">Loading...</strong></p>
                        </div>
                        <hr style="border:none; border-top:1px solid var(--divider); margin:8px 0">
                        <div>
                            <h3 class="small muted">Motion</h3>
                            <p>G-Force: <strong id="gforce">Loading...</strong></p>
                            <p>Mic: <strong id="mic">Loading...</strong></p>
                            <p>Expression: <strong id="expression">Loading...</strong></p>
                                <p>Expression code: <strong id="expression_code">Loading...</strong></p>
                        </div>
                        <hr style="border:none; border-top:1px solid var(--divider); margin:8px 0">
                        <div>
                            <h3 class="small muted">Alerts</h3>
                            <p id="alert">Loading...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

    <script>
        // Set the video feed src dynamically
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelector('img').src = BASE_URL + '/video_feed';
        });

        function updateStatus() {
            // fetch('https://logic-allocated-chapters-assessed.trycloudflare.com/env_status_api')
            fetch(BASE_URL + '/env_status_api')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('temp').textContent = data.temperature;
                    document.getElementById('hum').textContent = data.humidity;
                    document.getElementById('smoke').textContent = data.smoke_status;
                    document.getElementById('gforce').textContent = data.g_force_latest;
                    if (document.getElementById('mic')) document.getElementById('mic').textContent = data.mic_latest ?? 'N/A';
                    document.getElementById('expression').textContent = data.expression;
                    if (document.getElementById('expression_code')) {
                        document.getElementById('expression_code').textContent = data.expression_code ?? 'N/A';
                    }
                    document.getElementById('alert').textContent = data.critical_alert;

                    // Style alerts
                    const alertEl = document.getElementById('alert');
                    if (data.critical_alert.includes('FALL') || data.smoke_status.includes('DETECTED')) {
                        alertEl.className = 'alert';
                    } else {
                        alertEl.className = 'ok';
                    }
                })
                .catch(error => console.error('Error fetching status:', error));
        }

        // Update every 2 seconds
        setInterval(updateStatus, 2000);
        updateStatus(); // Initial load
    </script>
</body>
</html>